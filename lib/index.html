<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>Udacity Todos</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="stylesheet" src="./node_modules/bootstrap/dist/css/bootstrap.css"></link>
        <link rel="stylesheet" href="./dist/css/main.css">

        <script src="https://cdnjs.cloudflare.com/ajax/libs/redux/3.7.2/redux.min.js"></script>
        <script src="https://unpkg.com/redux-thunk@2.2.0/dist/redux-thunk.min.js"></script>
        <script src="https://unpkg.com/react@16.3.0-alpha.1/umd/react.development.js"></script>
        <script src="https://unpkg.com/react-dom@16.3.0-alpha.1/umd/react-dom.development.js"></script>
        <script src="https://unpkg.com/react-redux@5.0.6/dist/react-redux.min.js"></script>
        <script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>

        <script src="https://tylermcginnis.com/goals-todos-api/index.js"></script>
    </head>
    <body>
        <div id="app"></div>
        <script src="./dist/js/all.min.js"></script>
        <script type="text/babel">

            function List(props) {
                return (
                    <ul>
                        {props.items.map(item => (
                            <li key={item.id}>
                                <span  onClick={() => props.toggle && props.toggle(item.id)}
                                       className={item.complete ? 'complete' : ''}>
                                    {item.name}
                                </span>
                                <button onClick={() => props.remove(item)}>x</button>
                            </li>
                        ))}
                    </ul>
               )
            }

            class Todos extends React.Component {
                removeItem = (todo) => {
                    this.props.dispatch(handleRemoveTodo(todo))
                }
                toggleItem = (id) => {
                    this.props.dispatch(handleToggleTodoAction(id))
                }
                addItem = (e) => {
                    e.preventDefault()
                    this.props.dispatch(handleAddTodo(this.input.value))
                    .then(() => {
                        this.input.value = ''
                    });
                }
                render() {
                    return (
                        <div>
                            <h2>TODOS</h2>
                            <input type="text"
                                   placeholder="Add a todo"
                                   ref={(input) => this.input = input}/>
                            <button onClick={this.addItem}>Add todo</button>
                            <List toggle={this.toggleItem} remove={this.removeItem} items={this.props.todos}/>
                        </div>
                        )
                }
            }

            const ConnectedTodos = ReactRedux.connect((state) => ({
                todos: state.todos
            }))(Todos)

            class Goals extends React.Component {
                removeItem = (goal) => {
                    this.props.dispatch(handleRemoveGoal(goal))
                }
                addItem = (e) => {
                    e.preventDefault()
                    this.props.dispatch(handleAddGoal(this.input.value))
                    .then(() => {
                        this.input.value = ''
                    });
                }
                render() {
                    return (
                        <div>
                            <h2>GOALS</h2>
                            <input type="text"
                                   placeholder="Add a goal"
                                   ref={(input) => this.input = input}/>
                            <button onClick={this.addItem}>Add goal</button>
                            <List remove={this.removeItem} items={this.props.goals}/>
                        </div>
                        )
                }
            }

            const ConnectedGoals = ReactRedux.connect((state) => ({
                goals: state.goals
            }))(Goals)

            class App extends React.Component {
                componentDidMount = () => {
                    this.props.dispatch(handleInitialData())
                }
                render() {
                    if (this.props.loading === true) {
                        return <h1>Loading</h1>
                    }
                    return (
                        <div>
                            <h1>Todo list</h1>
                            <ConnectedTodos />
                            <ConnectedGoals />
                        </div>
                    )
                }
            }

            const ConnectedApp = ReactRedux.connect((state) => ({
                loading: state.loading
            }))(App)

            ReactDOM.render(
              <ReactRedux.Provider store={store}>
                  <ConnectedApp />
              </ReactRedux.Provider>,
              document.getElementById('app')
            );

        </script>
    </body>
</html>
